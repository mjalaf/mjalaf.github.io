---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage, tags } = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
	</head>

	<body>
		<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M4LH8GS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<Header />
		<main class="container mx-auto py-12 max-w-6xl">
			<div class="max-xl:py-10 max-xl:px-4 max-lg:py-10 max-lg:px-4 max-sm:py-10 max-sm:px-4">
				<article class="prose prose-invert max-w-none md:px-0 py-12">
					<!-- Header -->
					<header class="mb-6">
						<div class="flex items-center gap-4 text-sm mb-3">
							<span class="text-zinc-400">
								<FormattedDate date={pubDate} />
							</span>
							{
								updatedDate && (
									<span class="text-zinc-400 italic">
										Updated: <FormattedDate date={updatedDate} />
									</span>
								)
							}
						</div>

						<h1 class="text-4xl font-bold leading-tight mb-4 text-white">
							{title}
						</h1>

						{description && (
							<p class="text-lg text-zinc-400">{description}</p>
						)}

						{tags && tags.length > 0 && (
							<div class="flex flex-wrap gap-2 mt-4">
								{tags.map((tag) => (
									<a href={`/blog/tag/${tag}/`} class="rounded-full bg-zinc-800 px-3 py-1 text-xs text-zinc-300 no-underline hover:bg-zinc-700 transition">#{tag}</a>
								))}
							</div>
						)}
					</header>

					<!-- Hero image -->
					{heroImage && (
						<div class="mb-8">
							<Image
								width={1020}
								height={510}
								src={heroImage}
								alt=""
								class="rounded-xl w-full"
							/>
						</div>
					)}

					<!-- Content -->
					<section class="mdx-content">
						<slot />
					</section>
				</article>

				<!-- Disqus Comments -->
				<div class="mt-12 not-prose">
					<h3 class="text-xl font-semibold text-zinc-300 mb-6">Comments</h3>
					<div id="disqus_thread"></div>
					<script is:inline define:vars={{ title, canonicalURL: Astro.url.href }}>
						var disqus_config = function () {
							this.page.url = canonicalURL;
							this.page.title = title;
						};
						(function() {
							var d = document, s = d.createElement('script');
							s.src = 'https://mjalaf.disqus.com/embed.js';
							s.setAttribute('data-timestamp', +new Date());
							(d.head || d.body).appendChild(s);
						})();
					</script>
					<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				</div>
			</div>
		</main>
		<Footer />
	</body>
</html>
